{
  "id": "kanban-board-view",
  "title": "Replace EpicList home page with Kanban board view",
  "description": "## Overview\nReplace the current SAGA dashboard main page (EpicList) with a Kanban board that displays **all stories** (both standalone and epic-owned) grouped by derived status into three columns: Pending, In Progress, and Completed.\n\n## Architecture\n\n### New API Endpoint\nAdd `GET /api/stories?all=true` to the Express server that returns all stories from the `.saga/` directory — both standalone stories and stories belonging to epics — with the parent epic name resolved and included in the response. This builds on the existing `parser.ts` scanning logic. The existing `GET /api/stories` (without `?all=true`) continues to work as before for backward compatibility.\n\n### Kanban Board Page (`KanbanBoard.tsx`)\nA new page component that replaces EpicList as the `/` route. Layout:\n- 3-column layout filling the viewport height\n- Columns: **Pending** | **In Progress** | **Completed**\n- Each column scrolls independently (fixed-height columns, internal overflow-y scroll)\n- Column headers show the status name and story count\n- Stories are sorted within columns (most recently updated first, or alphabetically — implementation can decide)\n\n### Story Card (`StoryCard.tsx`)\nEach story is rendered as a collapsible card using shadcn `Card` + `Collapsible` components.\n\n**Collapsed state (default):**\n- Expand/collapse chevron icon (right-pointing when collapsed, down when expanded)\n- Story title\n- Parent epic name as a `Badge` tag (if the story belongs to an epic)\n- Compact meta line: progress bar (shadcn `Progress`) showing done/total tasks + task count text\n- Running session indicators: pulsing green dot next to title AND subtle glowing/pulsing border on the card\n\n**Expanded state:**\n- Down chevron\n- Story title + epic tag badge\n- Full description rendered as markdown (no truncation) — use the same markdown rendering approach as existing StoryDetail page\n- Task list with status icons:\n  - `✓` completed tasks\n  - `●` in-progress tasks  \n  - `○` pending tasks\n  - Show `(blocked by <task-id>)` for blocked tasks\n- Progress bar with `X/Y tasks done` label\n- Active session indicator if a session is running (green dot + \"Session running\" text)\n- \"Open story →\" link that navigates to `/story/:storyId`\n\n### Session Integration\nUse the existing WebSocket-driven session state from the XState dashboard machine (`sessions` in dashboard context). Match sessions to stories by `storyId` field. No new API needed for session data — it's already pushed via WebSocket `sessions:updated` events.\n\n### Real-Time Updates\n- The board should update in real-time when stories change (new tasks completed, status transitions) via the existing WebSocket `story:updated` events\n- Also handle `epics:updated` to refresh epic names\n- Handle `sessions:updated` to update running indicators\n- On initial load, fetch all stories via the new API endpoint, then rely on WebSocket for incremental updates\n\n### Routing Changes\n- Change the `/` route in `router.tsx` to render `KanbanBoard` instead of `EpicList`\n- Keep `EpicList.tsx` file intact (not deleted)\n- Keep `/epic/:epicId` and `/story/:storyId` routes unchanged\n\n## UI/Styling\n- Use **shadcn/ui components** (Card, Badge, Collapsible, Progress, Button) via the shadcn MCP server\n- Use the **existing CSS theme** variables from `index.css` (OKLCH color space):\n  - `--bg`, `--bg-light`, `--bg-dark` for backgrounds\n  - `--text`, `--text-muted` for text\n  - `--primary` for accents\n  - `--success` for completed/running indicators\n  - `--warning` for in-progress\n  - `--danger` for blocked items\n- Tailwind CSS 4 for layout and responsive design\n- The pulsing dot animation should use a CSS `@keyframes` pulse animation\n- The glowing border should use a subtle `box-shadow` animation with the `--success` color\n\n## Data Model Reference\n- **StoryDetail**: `{ id, title, description, epic?, status, tasks[], journal?, guidance?, doneWhen?, avoid?, branch?, pr?, worktree? }`\n- **Task**: `{ id, subject, description, status, blockedBy[], guidance?, doneWhen?, activeForm? }`\n- **Story status** is derived: `completed` if all tasks done, `inProgress` if any task in_progress, else `pending`\n- **SessionInfo**: `{ name, storyId, status, outputFile, outputAvailable, startTime, endTime?, outputPreview? }`\n\n## Acceptance Criteria\n- Home page (`/`) shows a 3-column Kanban board with all stories grouped by status\n- Cards are collapsible with smooth expand/collapse animation\n- Collapsed cards show: title, epic tag, compact progress bar, task count\n- Expanded cards show: full description (markdown), task list, progress bar, session indicator, \"Open\" link\n- Running sessions show pulsing green dot + glowing card border\n- Columns scroll independently when content overflows\n- Real-time updates via WebSocket work correctly\n- Existing routes (/epic/:id, /story/:id) still work\n- All new code uses shadcn/ui components and the existing theme",
  "guidance": "Use the shadcn MCP server to check component APIs and get usage examples before implementing. Key existing components: Card, Badge, Collapsible, Progress, Button. The existing `parser.ts` has `scanSagaDirectory()` which already reads all stories and epics — extend it or add a helper that aggregates all stories. For markdown rendering, check how `StoryDetail.tsx` or `EpicDetail.tsx` renders markdown descriptions and reuse the same approach. The XState dashboard machine already tracks `sessions` in context — use `useDashboard()` hook to access session state.",
  "doneWhen": "The dashboard home page shows a working Kanban board with all stories, cards expand/collapse correctly, running session indicators work, real-time updates function, and all existing routes still work.",
  "avoid": "Do not add drag-and-drop functionality — the board is read-only. Do not remove the EpicList component file. Do not create a new state management solution — use the existing XState machine and dashboard context. Do not add new npm dependencies for drag-and-drop libraries.",
  "branch": "story/kanban-board-view",
  "pr": "https://github.com/Roeia1/SAGA/pull/75",
  "worktree": ".saga/worktrees/kanban-board-view/"
}
